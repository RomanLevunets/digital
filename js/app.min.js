'use strict';

$(window).on("load", function () {
    //Preloader
    setTimeout(function () {
        $('.loader').fadeOut();
    }, 400);
});

if (window.innerWidth >= 1300) {
    if (document.getElementById('video-trailer')) {
        document.getElementById('video-trailer').innerHTML = '<video preload="auto" loop autoplay\n' + '               muted>\n' + '            <source src="static/bg.mp4" type="video/mp4"></source>\n' + '        </video>';
    }
    if (document.getElementById('video-trailer2')) {
        document.getElementById('video-trailer2').innerHTML = '<video preload="auto" loop autoplay\n' + '               muted>\n' + '            <source src="static/bg.mp4" type="video/mp4"></source>\n' + '        </video>';
    }
    if (document.getElementById('video-trailer3')) {
        document.getElementById('video-trailer3').innerHTML = '<video preload="auto" loop autoplay\n' + '               muted>\n' + '            <source src="static/bg.mp4" type="video/mp4"></source>\n' + '        </video>';
    }
}

$(document).ready(function () {
    if (document.getElementById('main-page')) {
        $(".header-nav .menu li a").click(function (e) {
            e.preventDefault();
            var aid = $(this).attr("href");
            $('html,body').animate({ scrollTop: $(aid).offset().top }, 1300);
        });
        $(".header-mob__wrap .menu li a").click(function (e) {
            e.preventDefault();
            var aid = $(this).attr("href");
            $('html,body').animate({ scrollTop: $(aid).offset().top }, 1300);
            $('.header__burger').removeClass('active');
            $('.header-mob__wrap').removeClass('open');
            $('.header-mob__bg').removeClass('open');
            $('body').removeClass('open');
        });
    }

    $('.portfolio-block').hover(function (e) {
        var $th = $(e.delegateTarget);
        $th.css({ 'z-index': 10 });
    }, function (e) {
        var $th = $(e.delegateTarget);
        $th.css({ 'z-index': 1 });
    });
    $('.map').hover(function () {
        var $th = $('.map-title');
        $th.fadeOut();
    }, function () {
        var $th = $('.map-title');
        $th.fadeIn();
    });

    $('input[name="tel"]').mask('+38(999)-999-99-99');

    $('.home-btn .btn').click(function (e) {
        e.preventDefault();
        $('#popup_feedback').fadeIn();
        $('.popup').removeClass('close').addClass('open');
        $('body').addClass('open');
    });

    $('.popup-close, .popup-bg').click(function (e) {
        e.preventDefault();
        $('.popup').removeClass('open').addClass('close').fadeOut();
        setTimeout(function () {
            $('body').removeClass('open');
        }, 350);
    });

    var dataRequiredForm = $('#popup_form').attr('data-required');
    var dataRequiredFormEmail = $('#popup_form').attr('data-email-required');
    var fakeAPI = 'https://jsonplaceholder.typicode.com/posts';
    $('#popup_form').validate({
        rules: {
            'email': {
                required: true,
                email: true
            },
            'name': {
                required: true
            },
            'company': {
                required: true
            },
            'tel': {
                required: true
            }
        },
        messages: {
            'email': {
                required: dataRequiredForm,
                email: dataRequiredFormEmail
            },
            'name': {
                required: dataRequiredForm
            },
            'company': {
                required: dataRequiredForm
            },
            'tel': {
                required: dataRequiredForm
            }
        },
        submitHandler: function submitHandler(form) {
            $.ajax({
                type: 'post',
                url: fakeAPI,
                data: $(form).serialize()
            }).done(function (response) {
                $('body').addClass('open');
                $('.feedback-form').trigger('reset');
                $('#popup_feedback').fadeOut();
                $('#popup_thanks').removeClass('close').addClass('open').fadeIn();
            }).fail(function (error) {
                alert(error);
            });
            return false;
        },
        // add error from parents block
        highlight: function highlight(element, errorClass, validClass) {
            $(element).parent().addClass('error').removeClass('valid');
        },
        unhighlight: function unhighlight(element, errorClass, validClass) {
            $(element).parent().addClass('valid').removeClass('error');
        }
    });

    $('#feedback').validate({
        rules: {
            'email': {
                required: true,
                email: true
            },
            'name': {
                required: true
            },
            'company': {
                required: true
            },
            'tel': {
                required: true
            }
        },
        messages: {
            'email': {
                required: dataRequiredForm,
                email: dataRequiredFormEmail
            },
            'name': {
                required: dataRequiredForm
            },
            'company': {
                required: dataRequiredForm
            },
            'tel': {
                required: dataRequiredForm
            }
        },
        submitHandler: function submitHandler(form) {
            $.ajax({
                type: 'post',
                url: fakeAPI,
                data: $(form).serialize()
            }).done(function (response) {
                $('body').addClass('open');
                $('.feedback-form').trigger('reset');
                $('#popup_feedback').fadeOut();
                $('#popup_thanks').removeClass('close').addClass('open').fadeIn();
            }).fail(function (error) {
                alert(error);
            });
            return false;
        },
        // add error from parents block
        highlight: function highlight(element, errorClass, validClass) {
            $(element).parent().addClass('error').removeClass('valid');
        },
        unhighlight: function unhighlight(element, errorClass, validClass) {
            $(element).parent().addClass('valid').removeClass('error');
        }
    });

    $('.header__burger').click(function () {
        $('.header__burger').toggleClass('active');
        $('.header-mob__wrap').toggleClass('open');
        $('.header-mob__bg').toggleClass('open');
        $('body').toggleClass('open');
    });

    // $('.header-mob__bg').click(function() {
    //     $('.header__burger').removeClass('active');
    //     $('.header-mob__wrap').removeClass('open');
    //     $('.header-mob__bg').removeClass('open');
    //     $('body').removeClass('open');
    // })

    //animation
    (function ($) {
        $.fn.animated = function (inEffect) {
            $(this).each(function () {
                var ths = $(this);
                ths.css("opacity", "0").addClass("animated").waypoint(function (dir) {
                    if (dir === "down") {
                        ths.addClass(inEffect).css("opacity", "1");
                    }
                }, {
                    offset: "90%"
                });
            });
        };
    })(jQuery);

    //deleted animation for mobile
    var isMobile = {
        Android: function Android() {
            return navigator.userAgent.match(/Android/i) ? true : false;
        },
        BlackBerry: function BlackBerry() {
            return navigator.userAgent.match(/BlackBerry/i) ? true : false;
        },
        iOS: function iOS() {
            return navigator.userAgent.match(/iPhone|iPad|iPod/i) ? true : false;
        },
        Windows: function Windows() {
            return navigator.userAgent.match(/IEMobile/i) ? true : false;
        },
        any: function any() {
            return isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Windows();
        }
    };

    function setDelay(items, animation) {
        items.animated(animation);
        items.each(function (index) {
            $(this).css({
                'animation-delay': 0.1 + index * 0.1 + 's'
            });
        });
    }

    function setDelayStart(items, animation) {
        items.animated(animation);
        items.each(function (index) {
            $(this).css({
                'animation-delay': 1.7 + index * 0.1 + 's'
            });
        });
    }

    if (!isMobile.any()) {
        $('body').addClass('no-touch');
        $('.why h2').animated('show_bot');
        $('.btn').animated('show_btn');
        $('.header-logo').animated('animation_logo');
        $('.home-container h1').animated('slide_top');
        $('.home-container h2').animated('slide_top');
        $('.portfolio-block').animated('slide_top');
        $('.home-decorator, .home-decorator_2').animated('animation_menu');
        setDelay($('.title'), 'slide_top');
        setDelayStart($('.menu li'), 'animation_menu');
        setDelay($('.weDo-item'), 'slide_top');
        setDelay($('.why-item'), 'slide_top');
        setDelay($('.feedback-input'), 'slide_top');
        setDelay($('.contacts-item'), 'slide_top');
    }
});